#!usr/bin/python

import re
import files
import sqlite3
class file_vulnerability:
        pass

def get_vulnerability (option):
        relist=[]
	cont=[]
        fileslist=files.get_listfiles()
        expression=[]
        connection= sqlite3.connect("Fraudatanalyzer.db")
        cursor= connection.cursor()
        for e in cursor.execute("SELECT  expression FROM vulnerabilities WHERE name = '%s'" %option):
        	c=list(e)
                expression.append(c[0])
	for x in range(len(expression)):
		e= re.compile(expression[x],re.I)
		relist.append(e)
	for file in fileslist:
                with open(file,"r") as f:
                	for line in f.readlines():
                        	line = line.strip()
                                if re.match(r'^\s*$', line): continue #If line is empty, continue with the next one
                                if line[0] == '#': continue
				if re.search(r'<.*?>',line): continue
                                if re.match(r'^(\/\*(\s*|.*?))|((\s*|.*?)\*\/)|(\/\/.*)$',line): continue
                                for r in range(len(relist)):
                                	if relist[r].search(line):						
						print file
						print line
						print relist[r].pattern
#get_vulnerability("xss")
